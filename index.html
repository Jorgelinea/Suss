<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publishing Platform</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #121212; color: white; text-align: center; }
        .tabs { display: none; }
        .tabs button { background: #333; color: white; padding: 10px; border: none; cursor: pointer; }
        .tabs button:hover { background: #555; }
        .tab-content { display: none; padding: 20px; }
        .active { display: block; }
        input, textarea { width: 90%; padding: 10px; margin: 5px; background: #222; color: white; border: 1px solid #444; }
        button { padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; }
        button:hover { background: #218838; }
        .post { border-bottom: 1px solid #444; padding: 10px; margin: 10px; }
        .description { color: gray; }
        .content { color: lightgreen; }
    </style>
</head>
<body>

    <div class="tabs">
        <button onclick="showTab('publicar')">Publish</button>
        <button onclick="showTab('perfil')">Profile</button>
        <button onclick="showTab('info')">Info</button>
        <button onclick="logout()">Logout</button>
    </div>

    <div id="login" class="tab-content active">
        <h2>Login / Register</h2>
        <input type="text" id="username" placeholder="Username (more than 4 characters)">
        <input type="password" id="password" placeholder="Password (more than 5 characters)">
        <button onclick="login()">Login</button>
        <button onclick="register()">Register</button>
    </div>

    <div id="publicar" class="tab-content">
        <h2>Post Text</h2>
        <input type="text" id="titulo" placeholder="Title">
        <input type="text" id="descripcion" placeholder="Description">
        <textarea id="contenido" placeholder="Content"></textarea>
        <button onclick="publicarTexto()">Publish</button>
        <h3>Posts:</h3>
        <div id="publicaciones"></div>
    </div>

    <div id="perfil" class="tab-content">
        <h2>Profile</h2>
        <p id="perfilInfo"></p>
    </div>

    <div id="info" class="tab-content">
        <h2>How it works?</h2>
        <p>Platform to write and share texts.</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Your Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",  // Replace with your Firebase API key
            authDomain: "YOUR_AUTH_DOMAIN",  // Replace with your Firebase Auth domain
            databaseURL: "YOUR_DATABASE_URL",  // Replace with your Firebase Realtime Database URL
            projectId: "YOUR_PROJECT_ID",  // Replace with your Firebase Project ID
            storageBucket: "YOUR_STORAGE_BUCKET",  // Replace with your Firebase Storage Bucket
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",  // Replace with your Firebase Messaging Sender ID
            appId: "YOUR_APP_ID"  // Replace with your Firebase App ID
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        document.addEventListener("DOMContentLoaded", () => {
            verificarSesion();
            cargarPublicaciones();
        });

        function verificarSesion() {
            let usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));
            let tabs = document.querySelector(".tabs");
            if (usuarioActivo) {
                tabs.style.display = "block"; 
                showTab("publicar");
            } else {
                tabs.style.display = "none";
                showTab("login");
            }
        }

        function showTab(tab) {
            document.querySelectorAll(".tab-content").forEach(e => e.classList.remove("active"));
            document.getElementById(tab).classList.add("active");

            if (tab === "perfil") {
                mostrarPerfilUsuarioActivo();
            }
        }

        function register() {
            let usuario = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();

            if (!usuario || !password) return alert("Please fill all fields");
            if (usuario.length <= 4) return alert("Username must be longer than 4 characters.");
            if (password.length <= 5) return alert("Password must be longer than 5 characters.");
            if (!/\d/.test(password)) return alert("Password must contain at least one number.");

            let usuariosRef = database.ref("usuarios");
            usuariosRef.once("value", (snapshot) => {
                let usuarios = snapshot.val() || [];
                if (usuarios.find(u => u.usuario === usuario)) return alert("Username already exists");

                let nuevoUsuario = { usuario, password, fecha: new Date(), rol: "normal" };
                usuariosRef.push(nuevoUsuario);
                localStorage.setItem("usuarioActivo", JSON.stringify(nuevoUsuario));
                alert("Successfully registered");
                verificarSesion();
            });
        }

        function login() {
            let usuario = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();

            let usuariosRef = database.ref("usuarios");
            usuariosRef.once("value", (snapshot) => {
                let usuarios = snapshot.val() || [];
                let user = usuarios.find(u => u.usuario === usuario && u.password === password);
                if (!user) return alert("Invalid credentials");
                localStorage.setItem("usuarioActivo", JSON.stringify(user));
                alert("Logged in");
                verificarSesion();
            });
        }

        function logout() {
            localStorage.removeItem("usuarioActivo");
            alert("Logged out");
            verificarSesion();
        }

        function mostrarPerfilUsuarioActivo() {
            let usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));
            if (!usuarioActivo) return;
            let perfilInfo = document.getElementById("perfilInfo");
            perfilInfo.innerHTML = `
                <b>Username:</b> ${usuarioActivo.usuario} <br>
                <b>Creation date:</b> ${new Date(usuarioActivo.fecha).toLocaleDateString()} <br>
                <b>Role:</b> ${usuarioActivo.rol.charAt(0).toUpperCase() + usuarioActivo.rol.slice(1)}
            `;
        }

        function publicarTexto() {
            let user = JSON.parse(localStorage.getItem("usuarioActivo"));
            if (!user) return alert("Log in to post");

            let titulo = document.getElementById("titulo").value.trim();
            let descripcion = document.getElementById("descripcion").value.trim();
            let contenido = document.getElementById("contenido").value.trim();
            if (!titulo || !descripcion || !contenido) return alert("All fields are required");

            let publicacionesRef = database.ref("publicaciones");
            publicacionesRef.push({ titulo, descripcion, contenido, usuario: user.usuario });
            cargarPublicaciones();
        }

        function cargarPublicaciones() {
            let publicacionesRef = database.ref("publicaciones");
            publicacionesRef.once("value", (snapshot) => {
                let publicaciones = snapshot.val() || [];
                let publicacionesDiv = document.getElementById("publicaciones");
                publicacionesDiv.innerHTML = "";

                Object.values(publicaciones).forEach((post, index) => {
                    let postDiv = document.createElement("div");
                    postDiv.classList.add("post");
                    postDiv.innerHTML = `
                        <b>${post.titulo}</b> <br>
                        <span class="description">${post.descripcion}</span> <br>
                        <span class="content">${post.contenido}</span> <br>
                        <i>Posted by: ${post.usuario}</i> <br>
                    `;
                    publicacionesDiv.appendChild(postDiv);
                });
            });
        }
    </script>

</body>
</html>
